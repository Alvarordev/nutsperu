---
import Layout from "../../layouts/Layout.astro";
import { products } from "../../data/products";
import { ProductDisplay } from "../../components/product/ProductDisplay";
import ProductCard from "../../components/productos/ProductCard.astro";

export async function getStaticPaths() {
    return products.map((product) => ({
        params: { slug: product.slug },
        props: { product },
    }));
}

const { product } = Astro.props;

const relatedProducts = products
    .filter((p) => p.category === product.category && p.slug !== product.slug)
    .slice(0, 3);
---

<Layout>
    <main class="relative w-full min-h-screen bg-background pb-20">
        <ProductDisplay client:load product={product} />

        {
            relatedProducts.length > 0 && (
                <section class="w-full max-w-300 mx-auto px-4 lg:px-0 mt-20">
                    <h2 class="font-title font-black text-3xl md:text-4xl text-foreground mb-8">
                        Productos Relacionados
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {relatedProducts.map((relatedProduct) => (
                            <ProductCard product={relatedProduct} />
                        ))}
                    </div>
                </section>
            )
        }
    </main>
</Layout>
